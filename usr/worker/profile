load std

# Set up expected directories and files
mkdir -p /keydb
mkdir -p $home/keyring

touch /keydb/keys

# Create common mount points
mkdir -p /mnt
mkdir -p /n
mkdir -p /tmp

mount -a {mntgen} /mnt
mount -a {mntgen} /n

# Set up network stack
ndb/cs
ndb/dns

# If key is present, then serve root dir
# and cpu as a worker
and {ftest -f $home^/keyring/default} {
	svc/net
	svc/rstyx
}
